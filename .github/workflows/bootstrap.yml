name: Bootstrap Workflow

env:
  TOOLS_BRANCH: dev

on:
  workflow_dispatch:
  pull_request:
    types: [opened, closed, synchronize]
  push:

jobs:
  call-assign-from-json-workflow:
    uses: Keyfactor/actions/.github/workflows/assign-env-from-json.yml@main

  download-and-call-second-workflow:
    runs-on: ubuntu-latest
    needs: [call-assign-from-json-workflow]
    steps:
    - name: Checkout
      id: checkout-project
      uses: actions/checkout@v4
      with:
        path: main

    - name: List tools
      if:  needs.call-assign-from-json-workflow.outputs.name != ''        
      run: |
        echo "Ref: $TOOLS_BRANCH"

    - name: Checkout tools repo
      id: get-tools
      uses: actions/checkout@v4
      with:
        repository: fiddlermikey/actions
        ref: ${{ env.TOOLS_BRANCH }}


    - name: Show name from json
      id: show-name
      if:  needs.call-assign-from-json-workflow.outputs.name != ''        
      run: |
        echo "Name=${{ needs.call-assign-from-json-workflow.outputs.name }}" | tee -a "$GITHUB_ENV"

    - name: Call Workflow
      if:  needs.call-assign-from-json-workflow.outputs.name != ''        
      id: run-action
      uses: ./.github/workflows/picker.yml
      with:
        buildtype: dotnet

    - name: List tools
      if:  always()  
      id: ls-action
      run: |
        ls -aR ./my-tools/.github/workflows/picker.yml | tee -a $GITHUB_STEP_SUMMARY

